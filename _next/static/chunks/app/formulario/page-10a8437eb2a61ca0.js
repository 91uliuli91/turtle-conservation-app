(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[343],{1247:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>m});var s=t(5155),n=t(2115);function o(e){let{onSelect:a}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center px-6 py-8 animate-fadeIn",children:[(0,s.jsxs)("div",{className:"mb-8 text-center",children:[(0,s.jsx)("h2",{className:"text-3xl font-light text-gray-100 mb-3",children:"Nuevo Registro"}),(0,s.jsx)("p",{className:"text-gray-400 text-lg",children:"\xbfQu\xe9 tipo de evento registras?"})]}),(0,s.jsx)("div",{className:"space-y-4 w-full max-w-sm",children:[{id:"arqueo",name:"Arqueo",icon:"\uD83D\uDC22",description:"Registro de tortuga avistada",gradient:"from-emerald-600 to-teal-600"},{id:"intento",name:"Intento",icon:"\uD83C\uDFD6️",description:"Intento de anidaci\xf3n",gradient:"from-amber-600 to-orange-600"},{id:"anidacion",name:"Anidaci\xf3n",icon:"\uD83E\uDD5A",description:"Nido con huevos",gradient:"from-blue-600 to-indigo-600"}].map(e=>(0,s.jsx)("button",{onClick:()=>a(e.id),className:"group w-full p-6 bg-gradient-to-r ".concat(e.gradient," rounded-2xl \n                       shadow-lg hover:shadow-xl transform hover:scale-105 \n                       transition-all duration-300 ease-out"),children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"text-4xl",children:e.icon}),(0,s.jsxs)("div",{className:"text-left flex-1",children:[(0,s.jsx)("div",{className:"text-xl font-semibold text-white mb-1",children:e.name}),(0,s.jsx)("div",{className:"text-white/80 text-sm",children:e.description})]}),(0,s.jsx)("div",{className:"text-white/60 group-hover:text-white transition-colors",children:"→"})]})},e.id))})]})}function r(e){let{onLocationConfirm:a,onBack:t}=e,[o,r]=(0,n.useState)(null),[l,i]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{i(!0),setTimeout(()=>{r({lat:20.617+(Math.random()-.5)*.01,lon:-87.0729+(Math.random()-.5)*.01}),i(!1)},1e3)},[]),l)?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center px-6 py-16 animate-fadeIn",children:[(0,s.jsxs)("div",{className:"relative mb-6",children:[(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin"}),(0,s.jsx)("div",{className:"absolute inset-0 w-16 h-16 border-4 border-emerald-400/20 rounded-full animate-pulse"})]}),(0,s.jsx)("h3",{className:"text-xl font-light text-gray-100 mb-2",children:"Obteniendo ubicaci\xf3n"}),(0,s.jsx)("p",{className:"text-gray-400 text-center",children:"Aseg\xfarate de tener el GPS activado"})]}):(0,s.jsxs)("div",{className:"flex flex-col px-6 py-8 animate-fadeIn",children:[(0,s.jsx)("div",{className:"mb-6 text-center",children:(0,s.jsx)("h2",{className:"text-2xl font-light text-gray-100 mb-2",children:"Confirmar Ubicaci\xf3n"})}),(0,s.jsxs)("div",{className:"w-full h-64 bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl  relative overflow-hidden mb-6 shadow-inner",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-emerald-900/20 to-blue-900/40",children:(0,s.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"w-4 h-4 bg-red-500 rounded-full animate-pulse"}),(0,s.jsx)("div",{className:"absolute -inset-2 border-2 border-red-400/50 rounded-full animate-ping"})]})})}),(0,s.jsxs)("div",{className:"absolute bottom-4 left-4 bg-black/60 backdrop-blur text-white  px-3 py-2 rounded-lg text-sm font-mono",children:["\uD83D\uDCCD ",null==o?void 0:o.lat.toFixed(6),", ",null==o?void 0:o.lon.toFixed(6)]})]}),(0,s.jsxs)("p",{className:"text-gray-400 text-center mb-8 leading-relaxed",children:["La ubicaci\xf3n se obtuvo autom\xe1ticamente",(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"text-gray-300",children:"\xbfEs correcta esta ubicaci\xf3n?"})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:t,className:"flex-1 py-4 bg-slate-800 hover:bg-slate-700 rounded-xl  text-gray-300 font-medium transition-all duration-200",children:"← Volver"}),(0,s.jsx)("button",{onClick:()=>o&&a(o.lat,o.lon),className:"flex-1 py-4 bg-gradient-to-r from-emerald-600 to-teal-600  hover:from-emerald-500 hover:to-teal-500 rounded-xl  text-white font-medium transition-all duration-200 shadow-lg",children:"✓ Confirmar"})]})]})}function l(e){let{eventType:a,onDetailsChange:t,onBack:o,onNext:r}=e,[l,i]=(0,n.useState)({numeroHuevos:0,largoCaparazon:50,anchoCaparazon:40,observaciones:"",seColocoMarca:!1,seRemarco:!1}),c=(e,a)=>{let s={...l,[e]:a};i(s),t(s)};return(0,s.jsxs)("div",{className:"flex flex-col px-6 py-8 animate-fadeIn",children:[(0,s.jsx)("div",{className:"mb-8 text-center",children:(0,s.jsx)("h2",{className:"text-2xl font-light text-gray-100 mb-2",children:"Detalles del Evento"})}),(0,s.jsxs)("div",{className:"mb-8 flex-1",children:["anidacion"===a&&(0,s.jsx)("div",{className:"space-y-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("label",{className:"block text-lg font-light text-gray-300 mb-6",children:"N\xfamero de Huevos"}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-8",children:[(0,s.jsx)("button",{className:"w-14 h-14 bg-slate-800 hover:bg-slate-700 rounded-full  text-2xl font-light text-gray-300 transition-all duration-200 shadow-lg hover:shadow-xl",onClick:()=>c("numeroHuevos",Math.max(0,l.numeroHuevos-1)),children:"−"}),(0,s.jsx)("div",{className:"text-4xl font-light text-white w-20 text-center",children:l.numeroHuevos}),(0,s.jsx)("button",{className:"w-14 h-14 bg-slate-800 hover:bg-slate-700 rounded-full  text-2xl font-light text-gray-300 transition-all duration-200 shadow-lg hover:shadow-xl",onClick:()=>c("numeroHuevos",l.numeroHuevos+1),children:"+"})]})]})}),("arqueo"===a||"anidacion"===a)&&(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("label",{className:"text-lg font-light text-gray-300",children:"Largo del caparaz\xf3n"}),(0,s.jsxs)("span",{className:"text-2xl font-light text-white",children:[l.largoCaparazon," cm"]})]}),(0,s.jsx)("input",{type:"range",min:"20",max:"200",value:l.largoCaparazon,onChange:e=>c("largoCaparazon",Number(e.target.value)),className:"w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer slider-thumb"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("label",{className:"text-lg font-light text-gray-300",children:"Ancho del caparaz\xf3n"}),(0,s.jsxs)("span",{className:"text-2xl font-light text-white",children:[l.anchoCaparazon," cm"]})]}),(0,s.jsx)("input",{type:"range",min:"15",max:"150",value:l.anchoCaparazon,onChange:e=>c("anchoCaparazon",Number(e.target.value)),className:"w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer slider-thumb"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("label",{className:"flex items-center gap-4 p-4 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800/70 transition-all duration-200",children:[(0,s.jsx)("input",{type:"checkbox",checked:l.seColocoMarca,onChange:e=>c("seColocoMarca",e.target.checked),className:"w-5 h-5 text-emerald-600 bg-slate-700 border-slate-600  rounded focus:ring-emerald-500 focus:ring-2"}),(0,s.jsx)("span",{className:"text-gray-300 font-light",children:"Se coloc\xf3 marca nueva"})]}),(0,s.jsxs)("label",{className:"flex items-center gap-4 p-4 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800/70 transition-all duration-200",children:[(0,s.jsx)("input",{type:"checkbox",checked:l.seRemarco,onChange:e=>c("seRemarco",e.target.checked),className:"w-5 h-5 text-emerald-600 bg-slate-700 border-slate-600  rounded focus:ring-emerald-500 focus:ring-2"}),(0,s.jsx)("span",{className:"text-gray-300 font-light",children:"Se remarc\xf3"})]})]})]}),"intento"===a&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFD6️"}),(0,s.jsxs)("p",{className:"text-gray-400 text-lg font-light",children:["No se requieren detalles adicionales",(0,s.jsx)("br",{}),"para intentos de anidaci\xf3n"]})]})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:o,className:"flex-1 py-4 bg-slate-800 hover:bg-slate-700 rounded-xl  text-gray-300 font-medium transition-all duration-200",children:"← Volver"}),(0,s.jsx)("button",{onClick:r,className:"flex-1 py-4 bg-gradient-to-r from-emerald-600 to-teal-600  hover:from-emerald-500 hover:to-teal-500 rounded-xl  text-white font-medium transition-all duration-200 shadow-lg",children:"Siguiente →"})]})]})}function i(e){let{onPhotosChange:a,onObservationsChange:t,onBack:o,onNext:r}=e,[l,i]=(0,n.useState)([]),[c,d]=(0,n.useState)("");return(0,s.jsxs)("div",{className:"flex flex-col px-6 py-8 h-full animate-fadeIn",children:[(0,s.jsx)("div",{className:"mb-8 text-center",children:(0,s.jsx)("h2",{className:"text-2xl font-light text-gray-100 mb-2",children:"Fotos y Observaciones"})}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("h3",{className:"text-lg font-light text-gray-300",children:["Fotos (",l.length,")"]}),(0,s.jsx)("button",{onClick:()=>{let e="https://picsum.photos/200/300?random=".concat(l.length+1),t=[...l,e];i(t),a(t)},className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600  hover:from-blue-500 hover:to-purple-500 rounded-xl  text-white font-medium transition-all duration-200 shadow-lg flex items-center gap-2",children:"\uD83D\uDCF8 Tomar Foto"})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4",children:l.map((e,t)=>(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("img",{src:e,alt:"Foto ".concat(t+1),className:"w-full h-32 object-cover rounded-xl"}),(0,s.jsx)("button",{onClick:()=>(e=>{let t=l.filter((a,t)=>t!==e);i(t),a(t)})(t),className:"absolute -top-2 -right-2 w-8 h-8 bg-red-500 hover:bg-red-600  text-white rounded-full text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:"\xd7"})]},t))}),0===l.length&&(0,s.jsxs)("div",{className:"text-center py-12 border-2 border-dashed border-slate-700 rounded-xl",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCF8"}),(0,s.jsxs)("p",{className:"text-gray-400 font-light",children:["No hay fotos a\xfan",(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"text-gray-500",children:"Toma la primera foto"})]})]})]}),(0,s.jsxs)("div",{className:"mb-8 flex-1",children:[(0,s.jsx)("h3",{className:"text-lg font-light text-gray-300 mb-4",children:"Observaciones"}),(0,s.jsx)("textarea",{value:c,onChange:e=>{d(e.target.value),t(e.target.value)},placeholder:"Escribe observaciones relevantes sobre el evento...",className:"w-full h-32 p-4 bg-slate-800/50 border border-slate-700  rounded-xl text-white placeholder-gray-500 resize-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500  transition-all duration-200"})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:o,className:"flex-1 py-4 bg-slate-800 hover:bg-slate-700 rounded-xl  text-gray-300 font-medium transition-all duration-200",children:"← Volver"}),(0,s.jsx)("button",{onClick:r,className:"flex-1 py-4 bg-gradient-to-r from-emerald-600 to-teal-600  hover:from-emerald-500 hover:to-teal-500 rounded-xl  text-white font-medium transition-all duration-200 shadow-lg",children:"Resumen →"})]})]})}function c(e){var a;let{eventData:t,onBack:n,onSave:o,isSaving:r}=e;return(0,s.jsxs)("div",{className:"flex flex-col p-4 h-full",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Resumen del Evento"}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-3 border-b border-gray-600 pb-2",children:"Informaci\xf3n General"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Tipo de Evento:"}),(0,s.jsx)("span",{className:"font-semibold",children:{arqueo:"Arqueo",intento:"Intento",anidacion:"Anidaci\xf3n"}[a=t.type]||a})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Ubicaci\xf3n:"}),(0,s.jsxs)("span",{className:"font-semibold",children:[t.location.lat.toFixed(6),", ",t.location.lon.toFixed(6)]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Fecha/Hora:"}),(0,s.jsx)("span",{className:"font-semibold",children:new Date().toLocaleString()})]})]})]}),"anidacion"===t.type&&void 0!==t.details.numeroHuevos&&(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-3 border-b border-gray-600 pb-2",children:"Detalles de Anidaci\xf3n"}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"N\xfamero de Huevos:"}),(0,s.jsx)("span",{className:"font-semibold",children:t.details.numeroHuevos})]})]}),("arqueo"===t.type||"anidacion"===t.type)&&(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-3 border-b border-gray-600 pb-2",children:"Mediciones"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Largo caparaz\xf3n:"}),(0,s.jsxs)("span",{className:"font-semibold",children:[t.details.largoCaparazon," cm"]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Ancho caparaz\xf3n:"}),(0,s.jsxs)("span",{className:"font-semibold",children:[t.details.anchoCaparazon," cm"]})]})]})]}),t.observations&&(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-3 border-b border-gray-600 pb-2",children:"Observaciones"}),(0,s.jsx)("p",{className:"text-gray-300",children:t.observations})]}),t.photos&&t.photos.length>0&&(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold mb-3 border-b border-gray-600 pb-2",children:["Fotos (",t.photos.length,")"]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:t.photos.slice(0,4).map((e,a)=>(0,s.jsx)("img",{src:e,alt:"Foto ".concat(a+1),className:"w-full h-20 object-cover rounded"},a))})]}),(0,s.jsxs)("div",{className:"flex gap-4 mt-auto",children:[(0,s.jsx)("button",{onClick:n,className:"flex-1 py-3 bg-gray-600 rounded-lg text-white font-semibold",disabled:r,children:"← Volver"}),(0,s.jsx)("button",{onClick:o,className:"flex-1 py-3 bg-green-600 rounded-lg text-white font-semibold disabled:bg-gray-600",disabled:r,children:r?(0,s.jsxs)("span",{className:"flex items-center justify-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Guardando...."]}):"✅ Guardar Evento"})]})]})}var d=t(9734);function x(){let[e,a]=(0,n.useState)(1),[t,x]=(0,n.useState)({type:"",location:{lat:0,lon:0},details:{},photos:[],observations:""}),[m,h]=(0,n.useState)(!1),[u,g]=(0,n.useState)("idle"),{isOnline:b,pendingSyncs:f,saveEventOffline:v,syncPendingEvents:p}=(0,d.j)(),j=()=>a(e=>e+1),N=()=>a(e=>e-1),y=(e,a)=>{x(t=>({...t,[e]:a}))};(0,n.useEffect)(()=>{b&&f>0&&(console.log("Intentando sincronizar eventos pendientes..."),p().catch(e=>{console.error("Error en sincronizaci\xf3n autom\xe1tica:",e)}))},[b,f,p]);let w=async()=>{h(!0),g("saving");try{if(b)console.log("Guardando online:",t),await new Promise(e=>setTimeout(e,2e3)),g("saved"),alert("✅ Evento guardado en l\xednea exitosamente!");else{let e=await v(t);g("saved"),alert("✅ Evento guardado offline (ID: ".concat(e,"). Se sincronizar\xe1 autom\xe1ticamente cuando haya conexi\xf3n."))}}catch(e){console.error("Error guardando evento:",e),g("error"),alert("❌ Error guardando el evento: ".concat(e instanceof Error?e.message:"Error desconocido",". Por favor intenta nuevamente."))}finally{h(!1)}};return(0,s.jsxs)("div",{className:"min-h-screen bg-black text-white p-4 relative",children:[(0,s.jsxs)("div",{className:"fixed top-4 right-4 px-3 py-1 rounded-full text-sm font-semibold z-50 ".concat(b?"bg-green-600":"bg-red-600"),children:[b?"\uD83D\uDFE2 En l\xednea":"\uD83D\uDD34 Offline",f>0&&" (".concat(f," pendientes)")]}),(0,s.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,s.jsx)("div",{className:"flex justify-between mb-8",children:[1,2,3,4,5].map(a=>(0,s.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat(e>=a?"bg-green-600":"bg-gray-600"),children:a},a))}),(()=>{switch(e){case 1:return(0,s.jsx)(o,{onSelect:e=>{y("type",e),j()}});case 2:return(0,s.jsx)(r,{onLocationConfirm:(e,a)=>{y("location",{lat:e,lon:a}),j()},onBack:N});case 3:return(0,s.jsx)(l,{eventType:t.type,onDetailsChange:e=>y("details",e),onBack:N,onNext:j});case 4:return(0,s.jsx)(i,{onPhotosChange:e=>y("photos",e),onObservationsChange:e=>y("observations",e),onBack:N,onNext:j});case 5:return(0,s.jsx)(c,{eventData:t,onBack:N,onSave:w,isSaving:m});default:return(0,s.jsx)("div",{children:"Paso no v\xe1lido"})}})(),"saving"===u&&(0,s.jsx)("div",{className:"fixed bottom-4 left-4 bg-blue-600 px-3 py-2 rounded",children:"Guardando..."}),"saved"===u&&(0,s.jsxs)("div",{className:"fixed bottom-4 left-4 bg-green-600 px-3 py-2 rounded",children:["✅ Guardado ",b?"en l\xednea":"offline"]})]})]})}function m(){return(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-green-50",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Nuevo Evento de Tortuga"}),(0,s.jsx)("p",{className:"text-gray-600 text-lg",children:"Registra un nuevo evento de anidaci\xf3n, arqueo o intento"})]}),(0,s.jsxs)("button",{onClick:()=>window.history.back(),className:"flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,s.jsx)("i",{className:"fas fa-arrow-left"}),(0,s.jsx)("span",{children:"Volver"})]})]}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-1",children:(0,s.jsx)(x,{})})]})})})}},6543:(e,a,t)=>{Promise.resolve().then(t.bind(t,1247))},9734:(e,a,t)=>{"use strict";t.d(a,{j:()=>c});var s=t(2115),n=t(3278);class o extends n.Ay{constructor(){super("TurtleConservationDB"),this.version(2).stores({eventos:"++id, tipo_evento, fecha_hora, sincronizado, createdAt, coordenada_lat, coordenada_lon"}),this.on("populate",()=>{console.log("Base de datos offline inicializada")})}}let r=new o,l=async()=>{try{return await r.open(),console.log("✅ Base de datos offline conectada"),!0}catch(e){return console.error("❌ Error conectando a la base de datos offline:",e),!1}},i=async e=>{let a=await fetch("/api/API_routes/eventos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tipo_evento:e.tipo_evento,fecha_hora:e.fecha_hora,campamento_id:e.campamento_id,zona_playa:e.zona_playa,coordenada_lat:e.coordenada_lat,coordenada_lon:e.coordenada_lon,tortuga_id:e.tortuga_id,personal_registro_id:1,observaciones:e.observaciones})});if(!a.ok)throw Error("Error ".concat(a.status,": ").concat(a.statusText));return a.json()},c=()=>{let[e,a]=(0,s.useState)(!0),[t,n]=(0,s.useState)(0),[o,c]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{try{await l(),c(!0);let e=await r.eventos.where("sincronizado").equals(0).count();n(e)}catch(e){console.error("Error inicializando DB:",e)}})()},[]),(0,s.useEffect)(()=>{a(navigator.onLine);let e=()=>{console.log("\uD83D\uDFE2 Conexi\xf3n restaurada"),a(!0)},t=()=>{console.log("\uD83D\uDD34 Sin conexi\xf3n"),a(!1)};return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);let d=async e=>{if(!o)throw Error("Base de datos no inicializada");try{let a=(e=>{var a,t;return{tipo_evento:e.type||"unknown",fecha_hora:new Date,coordenada_lat:Number(null==(a=e.location)?void 0:a.lat)||0,coordenada_lon:Number(null==(t=e.location)?void 0:t.lon)||0,detalles:e.details||{},fotos:Array.isArray(e.photos)?e.photos:[],observaciones:e.observations||null,campamento_id:null,zona_playa:null,tortuga_id:null,sincronizado:0,createdAt:new Date}})(e),t=await r.eventos.add(a);return n(e=>e+1),t}catch(e){throw console.error("Error guardando offline:",e),e}},x=async()=>{if(!e||!o)return void console.log("No hay conexi\xf3n o DB no lista, no se puede sincronizar");try{let e=await r.eventos.where("sincronizado").equals(0).toArray();for(let a of(console.log("Sincronizando ".concat(e.length," eventos pendientes...")),e))try{await i(a),await r.eventos.update(a.id,{sincronizado:1}),n(e=>e-1),console.log("✅ Evento ".concat(a.id," sincronizado"))}catch(e){console.error("Error sincronizando evento ".concat(a.id,":"),e)}}catch(e){console.error("Error obteniendo eventos pendientes:",e)}};return(0,s.useEffect)(()=>{e&&t>0&&(console.log("Conexi\xf3n recuperada, sincronizando eventos pendientes..."),x())},[e]),{isOnline:e,pendingSyncs:t,saveEventOffline:d,syncPendingEvents:x,countPendingEvents:async()=>{try{let e=await r.eventos.where("sincronizado").equals(0).count();return n(e),e}catch(e){return console.error("Error contando eventos pendientes:",e),0}},getPendingEvents:async()=>{try{return await r.eventos.where("sincronizado").equals(0).toArray()}catch(e){return console.error("Error obteniendo eventos pendientes:",e),[]}}}}}},e=>{e.O(0,[278,441,255,358],()=>e(e.s=6543)),_N_E=e.O()}]);