-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.campamentos
(
    id serial NOT NULL,
    nombre character varying(100) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT campamentos_pkey PRIMARY KEY (id),
    CONSTRAINT campamentos_nombre_key UNIQUE (nombre)
);

CREATE TABLE IF NOT EXISTS public.condiciones_ambientales
(
    id serial NOT NULL,
    evento_id integer NOT NULL,
    temperatura_arena_nido_c numeric(5, 2),
    humedad_arena_porcentaje numeric(5, 2),
    fase_lunar character varying(50) COLLATE pg_catalog."default",
    CONSTRAINT condiciones_ambientales_pkey PRIMARY KEY (id),
    CONSTRAINT condiciones_ambientales_evento_id_key UNIQUE (evento_id)
);

CREATE TABLE IF NOT EXISTS public.especies
(
    id serial NOT NULL,
    nombre_comun character varying(100) COLLATE pg_catalog."default" NOT NULL,
    nombre_cientifico character varying(100) COLLATE pg_catalog."default",
    CONSTRAINT especies_pkey PRIMARY KEY (id),
    CONSTRAINT especies_nombre_cientifico_key UNIQUE (nombre_cientifico),
    CONSTRAINT especies_nombre_comun_key UNIQUE (nombre_comun)
);

CREATE TABLE IF NOT EXISTS public.estado_zona
(
    id serial NOT NULL,
    descripcion character varying(100) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT estado_zona_pkey PRIMARY KEY (id),
    CONSTRAINT estado_zona_descripcion_key UNIQUE (descripcion)
);

CREATE TABLE IF NOT EXISTS public.estado_zona_evento
(
    id serial NOT NULL,
    evento_id integer NOT NULL,
    estado_zona_id integer NOT NULL,
    descripcion_adicional text COLLATE pg_catalog."default",
    CONSTRAINT estado_zona_evento_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.eventos
(
    id serial NOT NULL,
    tipo_evento character varying(50) COLLATE pg_catalog."default" NOT NULL,
    fecha_hora timestamp with time zone NOT NULL,
    campamento_id integer,
    zona_playa character varying(1) COLLATE pg_catalog."default",
    estacion_baliza character varying(50) COLLATE pg_catalog."default",
    coordenada_lat numeric(10, 8),
    coordenada_lon numeric(11, 8),
    tortuga_id integer,
    personal_registro_id integer,
    observaciones text COLLATE pg_catalog."default",
    CONSTRAINT eventos_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.exhumaciones
(
    id serial NOT NULL,
    nido_id integer NOT NULL,
    fecha_hora_exhumacion timestamp with time zone NOT NULL,
    crias_vivas_liberadas integer DEFAULT 0,
    crias_muertas_en_nido integer DEFAULT 0,
    crias_deformes integer DEFAULT 0,
    huevos_no_eclosionados integer DEFAULT 0,
    comentarios text COLLATE pg_catalog."default",
    CONSTRAINT exhumaciones_pkey PRIMARY KEY (id),
    CONSTRAINT exhumaciones_nido_id_key UNIQUE (nido_id)
);

CREATE TABLE IF NOT EXISTS public.nidos
(
    id serial NOT NULL,
    evento_anidacion_id integer NOT NULL,
    numero_huevos_recolectados integer NOT NULL,
    trasladado_a_corral boolean DEFAULT false,
    fecha_hora_traslado timestamp with time zone,
    identificador_en_corral character varying(100) COLLATE pg_catalog."default",
    fecha_probable_eclosion date,
    temperatura_media_corral_c numeric(5, 2),
    humedad_media_corral_porcentaje numeric(5, 2),
    observaciones_corral text COLLATE pg_catalog."default",
    CONSTRAINT nidos_pkey PRIMARY KEY (id),
    CONSTRAINT nidos_evento_anidacion_id_key UNIQUE (evento_anidacion_id)
);

CREATE TABLE IF NOT EXISTS public.observaciones_tortuga
(
    id serial NOT NULL,
    evento_id integer NOT NULL,
    largo_caparazon_cm numeric(5, 2),
    ancho_caparazon_cm numeric(5, 2),
    se_coloco_marca_nueva boolean DEFAULT false,
    se_remarco boolean DEFAULT false,
    path_fotos text COLLATE pg_catalog."default",
    CONSTRAINT observaciones_tortuga_pkey PRIMARY KEY (id),
    CONSTRAINT observaciones_tortuga_evento_id_key UNIQUE (evento_id)
);

CREATE TABLE IF NOT EXISTS public.personal
(
    id serial NOT NULL,
    nombre_completo character varying(150) COLLATE pg_catalog."default" NOT NULL,
    rol character varying(50) COLLATE pg_catalog."default",
    email character varying(255) COLLATE pg_catalog."default",
    password_hash character varying(255) COLLATE pg_catalog."default",
    activo boolean DEFAULT true,
    apellido character varying(100) COLLATE pg_catalog."default",
    CONSTRAINT personal_pkey PRIMARY KEY (id),
    CONSTRAINT personal_email_key UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS public.tortugas
(
    id serial NOT NULL,
    marca_principal character varying(50) COLLATE pg_catalog."default",
    especie_id integer,
    CONSTRAINT tortugas_pkey PRIMARY KEY (id),
    CONSTRAINT tortugas_marca_principal_key UNIQUE (marca_principal)
);

ALTER TABLE IF EXISTS public.condiciones_ambientales
    ADD CONSTRAINT condiciones_ambientales_evento_id_fkey FOREIGN KEY (evento_id)
    REFERENCES public.eventos (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS condiciones_ambientales_evento_id_key
    ON public.condiciones_ambientales(evento_id);


ALTER TABLE IF EXISTS public.estado_zona_evento
    ADD CONSTRAINT estado_zona_evento_estado_zona_id_fkey FOREIGN KEY (estado_zona_id)
    REFERENCES public.estado_zona (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.estado_zona_evento
    ADD CONSTRAINT estado_zona_evento_evento_id_fkey FOREIGN KEY (evento_id)
    REFERENCES public.eventos (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.eventos
    ADD CONSTRAINT eventos_campamento_id_fkey FOREIGN KEY (campamento_id)
    REFERENCES public.campamentos (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.eventos
    ADD CONSTRAINT eventos_personal_registro_id_fkey FOREIGN KEY (personal_registro_id)
    REFERENCES public.personal (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.eventos
    ADD CONSTRAINT eventos_tortuga_id_fkey FOREIGN KEY (tortuga_id)
    REFERENCES public.tortugas (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE SET NULL;


ALTER TABLE IF EXISTS public.exhumaciones
    ADD CONSTRAINT exhumaciones_nido_id_fkey FOREIGN KEY (nido_id)
    REFERENCES public.nidos (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS exhumaciones_nido_id_key
    ON public.exhumaciones(nido_id);


ALTER TABLE IF EXISTS public.nidos
    ADD CONSTRAINT nidos_evento_anidacion_id_fkey FOREIGN KEY (evento_anidacion_id)
    REFERENCES public.eventos (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS nidos_evento_anidacion_id_key
    ON public.nidos(evento_anidacion_id);


ALTER TABLE IF EXISTS public.observaciones_tortuga
    ADD CONSTRAINT observaciones_tortuga_evento_id_fkey FOREIGN KEY (evento_id)
    REFERENCES public.eventos (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS observaciones_tortuga_evento_id_key
    ON public.observaciones_tortuga(evento_id);


ALTER TABLE IF EXISTS public.tortugas
    ADD CONSTRAINT tortugas_especie_id_fkey FOREIGN KEY (especie_id)
    REFERENCES public.especies (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE SET NULL;

END;